#!/usr/bin/env python3\n\"\"\"\nğŸš ì™„ì „í•œ PPO-ROS2-RViz í†µí•© ì‹œìŠ¤í…œ\nê°•í™”í•™ìŠµ ë“œë¡  + ë§µ ì‹œê°í™” + ì‹¤ì‹œê°„ ì œì–´\n\"\"\"\n\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, ExecuteProcess, TimerAction, GroupAction\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node, SetParameter\nfrom launch_ros.substitutions import FindPackageShare\nfrom launch.conditions import IfCondition\nimport os\n\ndef generate_launch_description():\n    # ëŸ°ì¹˜ ì¸ìˆ˜ ì •ì˜\n    use_sim_time_arg = DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='true',\n        description='ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„ ì‚¬ìš© ì—¬ë¶€'\n    )\n    \n    rviz_arg = DeclareLaunchArgument(\n        'rviz',\n        default_value='true',\n        description='RViz ì‹¤í–‰ ì—¬ë¶€'\n    )\n    \n    fcu_url_arg = DeclareLaunchArgument(\n        'fcu_url',\n        default_value='udp://:14540@127.0.0.1:14557',\n        description='FCU ì—°ê²° URL (PX4 SITL)'\n    )\n    \n    # TF2 Static Transform Publisher - ì¢Œí‘œê³„ ì„¤ì •\n    tf_base_to_map = Node(\n        package='tf2_ros',\n        executable='static_transform_publisher',\n        name='tf_base_to_map',\n        arguments=['0', '0', '0', '0', '0', '0', 'map', 'base_link'],\n        output='screen'\n    )\n    \n    tf_base_to_body = Node(\n        package='tf2_ros',\n        executable='static_transform_publisher',\n        name='tf_base_to_body',\n        arguments=['0', '0', '0', '0', '0', '0', 'base_link', 'base_link_frd'],\n        output='screen'\n    )\n    \n    # MAVROS ë…¸ë“œ\n    mavros_node = Node(\n        package='mavros',\n        executable='mavros_node',\n        name='mavros',\n        output='screen',\n        parameters=[{\n            'fcu_url': LaunchConfiguration('fcu_url'),\n            'gcs_url': '',\n            'target_system_id': 1,\n            'target_component_id': 1,\n            'fcu_protocol': 'v2.0',\n            'system_id': 255,\n            'component_id': 240,\n            'startup_px4_usb_quirk': True,\n            'use_sim_time': LaunchConfiguration('use_sim_time'),\n        }],\n        respawn=True,\n        respawn_delay=2\n    )\n    \n    # PPO-ROS2 ë¸Œë¦¿ì§€ ë…¸ë“œ (ê°•í™”í•™ìŠµ + ROS2 í†µí•©)\n    ppo_bridge_node = TimerAction(\n        period=3.0,\n        actions=[\n            Node(\n                package='ppo_drone_ros2',\n                executable='ros2_ppo_bridge.py',\n                name='ppo_bridge',\n                output='screen',\n                parameters=[{\n                    'use_sim_time': LaunchConfiguration('use_sim_time'),\n                    'control_rate': 20,\n                    'visualize': True,\n                    'publish_path': True,\n                    'publish_markers': True,\n                }],\n                respawn=True,\n                respawn_delay=2\n            )\n        ]\n    )\n    \n    # ë“œë¡  ìƒíƒœ í¼ë¸”ë¦¬ì…” (ìœ„ì¹˜, ìì„¸, ì†ë„ ì •ë³´)\n    drone_state_node = TimerAction(\n        period=2.0,\n        actions=[\n            Node(\n                package='ppo_drone_ros2',\n                executable='drone_state_publisher.py',\n                name='drone_state_publisher',\n                output='screen',\n                parameters=[{\n                    'use_sim_time': LaunchConfiguration('use_sim_time'),\n                    'publish_rate': 30,\n                }],\n                respawn=True\n            )\n        ]\n    )\n    \n    # ë§µ ì„œë²„ (ê°€ìƒ 3D í™˜ê²½)\n    map_server_node = Node(\n        package='nav2_map_server',\n        executable='map_server',\n        name='map_server',\n        output='screen',\n        parameters=[{\n            'yaml_filename': PathJoinSubstitution([\n                FindPackageShare('ppo_drone_ros2'),\n                'maps',\n                'drone_arena.yaml'\n            ]),\n            'use_sim_time': LaunchConfiguration('use_sim_time'),\n        }]\n    )\n    \n    # RViz2 ì„¤ì •\n    rviz_config_path = PathJoinSubstitution([\n        FindPackageShare('ppo_drone_ros2'),\n        'config',\n        'drone_visualization.rviz'\n    ])\n    \n    rviz_node = Node(\n        package='rviz2',\n        executable='rviz2',\n        name='rviz2',\n        arguments=['-d', rviz_config_path],\n        output='screen',\n        parameters=[{\n            'use_sim_time': LaunchConfiguration('use_sim_time'),\n        }],\n        condition=IfCondition(LaunchConfiguration('rviz'))\n    )\n    \n    # ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„ ì„¤ì •\n    set_use_sim_time = SetParameter(\n        name='use_sim_time',\n        value=LaunchConfiguration('use_sim_time')\n    )\n    \n    return LaunchDescription([\n        # ëŸ°ì¹˜ ì¸ìˆ˜ë“¤\n        use_sim_time_arg,\n        rviz_arg,\n        fcu_url_arg,\n        \n        # ê¸€ë¡œë²Œ íŒŒë¼ë¯¸í„°\n        set_use_sim_time,\n        \n        # TF2 ì¢Œí‘œê³„\n        tf_base_to_map,\n        tf_base_to_body,\n        \n        # ì½”ì–´ ë…¸ë“œë“¤\n        mavros_node,\n        \n        # ì• í”Œë¦¬ì¼€ì´ì…˜ ë…¸ë“œë“¤ (ìˆœì°¨ ì‹œì‘)\n        ppo_bridge_node,\n        drone_state_node,\n        \n        # ì‹œê°í™”\n        map_server_node,\n        rviz_node,\n    ]) 