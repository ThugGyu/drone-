#!/usr/bin/env python3\n\"\"\"\nğŸš PPO ê°•í™”í•™ìŠµ + RViz ë°ëª¨ ëŸ°ì¹˜ íŒŒì¼\në“œë¡  ì‹œë®¬ë ˆì´ì…˜, ê°•í™”í•™ìŠµ ëª¨ë¸, RViz ì‹œê°í™” í†µí•© ì‹œìŠ¤í…œ\n\"\"\"\n\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, ExecuteProcess, TimerAction, GroupAction, IncludeLaunchDescription\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution, FindExecutable\nfrom launch_ros.actions import Node, SetParameter\nfrom launch_ros.substitutions import FindPackageShare\nfrom launch.conditions import IfCondition\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nimport os\n\ndef generate_launch_description():\n    # ëŸ°ì¹˜ ì¸ìˆ˜ ì •ì˜\n    use_sim_time_arg = DeclareLaunchArgument(\n        'use_sim_time',\n        default_value='true',\n        description='ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„ ì‚¬ìš© ì—¬ë¶€'\n    )\n    \n    rviz_arg = DeclareLaunchArgument(\n        'rviz',\n        default_value='true', \n        description='RViz ì‹¤í–‰ ì—¬ë¶€'\n    )\n    \n    ppo_model_arg = DeclareLaunchArgument(\n        'ppo_model',\n        default_value='',\n        description='ì‚¬ìš©í•  PPO ëª¨ë¸ ê²½ë¡œ (ë¹ˆ ê°’ì´ë©´ ìµœì‹  ëª¨ë¸ ìë™ ì„ íƒ)'\n    )\n    \n    # íŒŒë¼ë¯¸í„° ì„¤ì •\n    use_sim_time = LaunchConfiguration('use_sim_time')\n    rviz_enabled = LaunchConfiguration('rviz')\n    ppo_model_path = LaunchConfiguration('ppo_model')\n    \n    # í˜„ì¬ íŒ¨í‚¤ì§€ ê²½ë¡œ\n    pkg_share = FindPackageShare('drone_ppo')\n    \n    # RViz ì„¤ì • íŒŒì¼\n    rviz_config_file = PathJoinSubstitution([\n        pkg_share,\n        'config',\n        'drone_visualization.rviz'\n    ])\n    \n    # ë§µ íŒŒì¼\n    map_file = PathJoinSubstitution([\n        pkg_share,\n        'maps',\n        'drone_arena.yaml'\n    ])\n    \n    # Static Transform Publishers (ì¢Œí‘œê³„ ì„¤ì •)\n    static_transforms = GroupAction([\n        # World -> Map ë³€í™˜\n        Node(\n            package='tf2_ros',\n            executable='static_transform_publisher',\n            name='world_to_map_publisher',\n            arguments=['0', '0', '0', '0', '0', '0', 'world', 'map'],\n            parameters=[{'use_sim_time': use_sim_time}]\n        ),\n        \n        # Map -> Odom ë³€í™˜\n        Node(\n            package='tf2_ros',\n            executable='static_transform_publisher',\n            name='map_to_odom_publisher',\n            arguments=['0', '0', '0', '0', '0', '0', 'map', 'odom'],\n            parameters=[{'use_sim_time': use_sim_time}]\n        ),\n        \n        # Odom -> Base_link ë³€í™˜ (ë™ì ìœ¼ë¡œ ë“œë¡  ìœ„ì¹˜ì— ë”°ë¼ ì—…ë°ì´íŠ¸ë¨)\n        Node(\n            package='tf2_ros',\n            executable='static_transform_publisher',\n            name='odom_to_base_link_publisher',\n            arguments=['0', '0', '0', '0', '0', '0', 'odom', 'base_link'],\n            parameters=[{'use_sim_time': use_sim_time}]\n        )\n    ])\n    \n    # ë§µ ì„œë²„ (ë‚˜ì¤‘ì— ì‹¤ì œ ë§µ íŒŒì¼ì´ ìˆì„ ë•Œ í™œì„±í™”)\n    map_server = Node(\n        package='nav2_map_server',\n        executable='map_server',\n        name='map_server',\n        output='screen',\n        parameters=[{\n            'yaml_filename': map_file,\n            'use_sim_time': use_sim_time\n        }],\n        condition=IfCondition('false')  # ì¼ë‹¨ ë¹„í™œì„±í™”\n    )\n    \n    # ë“œë¡  ìƒíƒœ í¼ë¸”ë¦¬ì…” (ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ìƒì„±)\n    drone_state_publisher = Node(\n        package='drone_ppo',\n        executable='drone_state_publisher.py',\n        name='drone_state_publisher',\n        output='screen',\n        parameters=[{\n            'publish_rate': 30,\n            'use_sim_time': use_sim_time\n        }]\n    )\n    \n    # PPO-ROS2 ë¸Œë¦¿ì§€ (ê°•í™”í•™ìŠµ ëª¨ë¸ê³¼ ROS2 ì—°ê²°)\n    ppo_bridge = Node(\n        package='drone_ppo',\n        executable='ros2_ppo_bridge.py',\n        name='ppo_bridge',\n        output='screen',\n        parameters=[{\n            'model_path': ppo_model_path,\n            'control_frequency': 20.0,\n            'use_sim_time': use_sim_time\n        }]\n    )\n    \n    # ëª©í‘œ ì§€ì  í¼ë¸”ë¦¬ì…” (ëŒ€í™”í˜• ëª©í‘œ ì„¤ì •)\n    goal_publisher = Node(\n        package='drone_ppo',\n        executable='goal_publisher.py',\n        name='goal_publisher',\n        output='screen',\n        parameters=[{\n            'use_sim_time': use_sim_time,\n            'default_goal_x': 10.0,\n            'default_goal_y': 10.0,\n            'default_goal_z': 5.0\n        }]\n    )\n    \n    # RViz ì‹œê°í™”\n    rviz_node = Node(\n        package='rviz2',\n        executable='rviz2',\n        name='rviz2',\n        arguments=['-d', rviz_config_file],\n        parameters=[{'use_sim_time': use_sim_time}],\n        output='screen',\n        condition=IfCondition(rviz_enabled)\n    )\n    \n    # ë“œë¡  ì‹œë®¬ë ˆì´í„° (MAVROS ëŒ€ì‹  ê°„ë‹¨í•œ ì‹œë®¬ë ˆì´ì…˜)\n    drone_simulator = Node(\n        package='drone_ppo',\n        executable='simple_drone_simulator.py',\n        name='simple_drone_simulator',\n        output='screen',\n        parameters=[{\n            'use_sim_time': use_sim_time,\n            'physics_rate': 100.0,\n            'publish_rate': 50.0\n        }]\n    )\n    \n    # ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë…¸ë“œ\n    performance_monitor = Node(\n        package='drone_ppo',\n        executable='performance_monitor.py',\n        name='performance_monitor',\n        output='screen',\n        parameters=[{\n            'use_sim_time': use_sim_time,\n            'log_frequency': 1.0\n        }]\n    )\n    \n    # ì‹œì‘ ì§€ì—° ì„¤ì •\n    delayed_ppo_bridge = TimerAction(\n        period=3.0,  # 3ì´ˆ í›„ PPO ë¸Œë¦¿ì§€ ì‹œì‘\n        actions=[ppo_bridge]\n    )\n    \n    delayed_goal_publisher = TimerAction(\n        period=5.0,  # 5ì´ˆ í›„ ëª©í‘œ í¼ë¸”ë¦¬ì…” ì‹œì‘\n        actions=[goal_publisher]\n    )\n    \n    # ì‹œì‘ ë©”ì‹œì§€\n    startup_message = ExecuteProcess(\n        cmd=['echo', 'ğŸš PPO ë“œë¡  + RViz ë°ëª¨ ì‹œìŠ¤í…œ ì‹œì‘ë¨!'],\n        output='screen'\n    )\n    \n    return LaunchDescription([\n        # ëŸ°ì¹˜ ì¸ìˆ˜ë“¤\n        use_sim_time_arg,\n        rviz_arg,\n        ppo_model_arg,\n        \n        # ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„ ì„¤ì •\n        SetParameter(name='use_sim_time', value=use_sim_time),\n        \n        # ì‹œì‘ ë©”ì‹œì§€\n        startup_message,\n        \n        # ì¢Œí‘œê³„ ë³€í™˜\n        static_transforms,\n        \n        # í•µì‹¬ ë…¸ë“œë“¤\n        drone_simulator,\n        drone_state_publisher,\n        performance_monitor,\n        \n        # ì§€ì—°ëœ ì‹œì‘\n        delayed_ppo_bridge,\n        delayed_goal_publisher,\n        \n        # ì‹œê°í™”\n        rviz_node,\n        \n        # ë§µ ì„œë²„ (í•„ìš”ì‹œ)\n        # map_server,\n    ]) 